#include "HX711.h"
#include <Servo.h>

// HX711 circuit wiring
#define DT_PIN  2
#define SCK_PIN 3

// Servo pins
#define SERVO1_PIN 5
#define SERVO2_PIN 6

// Weight threshold (grams) to detect object
#define WEIGHT_THRESHOLD 50

HX711 scale;
Servo servo1;
Servo servo2;

void setup() {
  Serial.begin(9600);

  // Initialize load cell
  scale.begin(DT_PIN, SCK_PIN);
  scale.set_scale(); // Set your scale factor after calibration
  scale.tare(); // Reset the scale to 0

  // Attach servos
  servo1.attach(SERVO1_PIN);
  servo2.attach(SERVO2_PIN);

  // Set initial servo positions
  servo1.write(90);
  servo2.write(90);

  Serial.println("Useless Table Ready");
}

void loop() {
  float weight = scale.get_units();

  Serial.print("Weight: ");
  Serial.println(weight);

  // Check if weight exceeds threshold
  if (weight > WEIGHT_THRESHOLD) {
    dropObject();
  }

  delay(200);
}

void dropObject() {
  Serial.println("Object Detected - Dropping!");

  // Tilt table to drop the object
  servo1.write(0);
  servo2.write(180);
  delay(1000);

  // Reset table to normal position
  servo1.write(90);
  servo2.write(90);
  delay(500);

  // Reset scale reading
  scale.tare();
}